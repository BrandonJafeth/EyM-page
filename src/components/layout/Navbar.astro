---
import siteData from '../../data/site.json';

const links = [
  { text: 'Inicio', href: '/' },
  { text: 'Sobre Nosotros', href: '/sobre-nosotros' },
  { text: 'Servicios', href: '/servicios' },
  { text: 'Contacto', href: '/contacto' },
];

const currentPath = Astro.url.pathname;
const isHomePage = currentPath === '/';

const headerClass = isHomePage 
  ? "fixed top-0 w-full z-50 transition-all duration-300 bg-transparent text-white border-b border-[rgba(203,213,224,0.1)] h-20"
  : "fixed top-0 w-full z-50 transition-all duration-300 bg-[#091723] text-white border-b border-[rgba(203,213,224,0.1)] h-20 shadow-md";
---

<header id="navbar" class={headerClass} data-is-home={isHomePage}>
  <div class="px-6 md:px-[120px] h-full">
    <div class="flex items-center justify-between h-full transition-all duration-300" id="navbar-container">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0 group flex items-center gap-4">
        <img 
          src={siteData.logo} 
          alt={siteData.name} 
          class="h-12 w-auto object-contain transition-transform duration-300 group-hover:scale-105"
        />
      </a>

      <!-- Desktop Menu -->
      <nav class="hidden md:flex items-center gap-14">
        {links.map(link => {
          const isActive = link.href === '/' ? currentPath === '/' : currentPath.startsWith(link.href);
          return (
            <a
              href={link.href}
              class="relative group py-3"
            >
              <span
                class:list={[
                  "font-heading text-base tracking-[0.5px] font-normal transition-colors",
                  isActive ? "text-[#AF9232]" : "text-white"
                ]}
              >
                {link.text}
              </span>
              {/* Active/Hover underline */}
               <div
                class:list={[
                  "absolute bottom-0 left-0 right-0 h-[2px] transition-all duration-300 bg-[#AF9232]",
                  isActive ? "opacity-100" : "opacity-0 group-hover:opacity-100"
                ]}
              ></div>
            </a>
          );
        })}
      </nav>

      <!-- CTA Button -->
      <div class="hidden md:block">
        <a 
          href="/contacto" 
          class="group font-heading text-base text-white border border-[#AF9232] bg-transparent hover:bg-[#AF9232] hover:text-[#091723] px-8 py-3 rounded-[2px] tracking-[0.05em] transition-all duration-300 cursor-pointer inline-block"
        >
          CONTACTAR
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button id="mobile-menu-btn" class="md:hidden text-white focus:outline-none p-2" aria-label="Menu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-menu" class="fixed inset-0 bg-[#091723] z-40 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col items-center justify-center space-y-8">
    <button id="close-menu-btn" class="absolute top-6 right-6 text-white p-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <div class="flex flex-col items-center space-y-8 text-xl">
      {links.map(link => (
        <a href={link.href} class="text-white hover:text-[#AF9232] font-heading text-2xl transition-colors">
          {link.text}
        </a>
      ))}
      <a href="/contacto" class="mt-4 font-heading text-lg text-[#091723] bg-[#AF9232] border border-[#AF9232] px-8 py-3 rounded-[2px] tracking-[0.05em] transition-all">
        CONTACTAR
      </a>
    </div>
  </div>
</header>

<script>
  const navbar = document.getElementById('navbar');
  const navbarContainer = document.getElementById('navbar-container');
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const closeMenuBtn = document.getElementById('close-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');

  // Sticky Navbar Effect
  function updateNavbar() {
    const isHome = navbar?.dataset.isHome === 'true';

    if (!isHome) {
        // En otras páginas siempre es sólido
        return;
    }

    if (window.scrollY > 50) {
      navbar?.classList.add('bg-[#091723]', 'shadow-md');
      navbar?.classList.remove('bg-transparent', 'border-[rgba(203,213,224,0.1)]');
    } else {
      navbar?.classList.remove('bg-[#091723]', 'shadow-md');
      navbar?.classList.add('bg-transparent', 'border-[rgba(203,213,224,0.1)]');
    }
  }

  window.addEventListener('scroll', updateNavbar);
  updateNavbar(); // Init

  // Mobile Menu Logic
  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.remove('translate-x-full');
    document.body.style.overflow = 'hidden'; // Prevent scrolling
  });

  closeMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.add('translate-x-full');
    document.body.style.overflow = '';
  });
</script>
